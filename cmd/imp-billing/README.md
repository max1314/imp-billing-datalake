
# Classic Billing commands

imp-billing is a command line utility used to read accounts/deployments data and generate billing reports. See [design doc](https://docs.google.com/document/d/1Jd8om_J9oaDS3siwoa36pReRBzC_Y8I0C04WDcpwpKs/edit#)

## Inputs

### Scraped accounts/deployments data

Scraped accounts/deployments data is in `billing-bucket-name` bucket, default `cn-improbable-billing`, they are generated by another command line utility `analytics`

### Contracts data

Contract sku data is in `contract-bucket-name` bucket, default `cn-improbable-contracts`, they are manually input, source from customer contracts.

## Output

Generated billing report will be put in `billing-bucket-name` bucket.

# IMP Billing commands

## DataLake operations
### For S3
```
// list datalake files by filepath
imp-billing datalake list --bucket_path=<bucket-path> --s3_credentials_key_id=<key> --s3_credentials_secret=<secret> --s3_endpoint=<endpoint> --s3_region=<region>

// write local file to datalake
imp-billing datalake write --src_path=<src-path> --dst_path=<dst-path> --s3_credentials_key_id=<key> --s3_credentials_secret=<secret> --s3_endpoint=<endpoint> --s3_region=<region>

// read datalake file by filepath
imp-billing datalake read --src_path=<src-path> --dst_path=<dst-path> --s3_credentials_key_id=<key> --s3_credentials_secret=<secret> --s3_endpoint=<endpoint> --s3_region=<region>
```
* `bucket-path` is the bucket full name, like `s3://your-bucket-name/your-file-path` .
* `src-path` is the source path, like `file/path/name` when `write` or `s3://your-bucket-name/your-file-path` when `read`.
* `dst-path` is the destination path, like `file/path/name` when `read` or `s3://your-bucket-name/your-file-path` when `write`.
* `key` is a bucket access key.
* `secret` is a bucket access secret.
* `endpoint` is the bucket access endpoint, like `s3.cn-northwest-1.amazonaws.com.cn`.
* `region` is the storage backend region, like `cn-northwest-1`. 

### For GCS
```
// list datalake files by filepath
imp-billing datalake list --bucket_path=<bucket-path> --gcs_credentials_account=<account> --gcs_credentials_secret=<secret> --gcs_credentials_type=<type> --gcs_signed_url_expiration_time=<expiration>

// write local file to datalake
imp-billing datalake write --src_path=<src-path> --dst_path=<dst-path> --gcs_credentials_account=<account> --gcs_credentials_secret=<secret> --gcs_credentials_type=<type> --gcs_signed_url_expiration_time=<expiration>

// read datalake file by filepath
imp-billing datalake read --src_path=<src-path> --dst_path=<dst-path> --gcs_credentials_account=<account> --gcs_credentials_secret=<secret> --gcs_credentials_type=<type> --gcs_signed_url_expiration_time=<expiration>
```
* `bucket-path` is the bucket full name, like `gcs://your-bucket-name/your-file-path` .
* `src-path` is the source path, like `file/path/name` when `write` or `gcs://your-bucket-name/your-file-path` when `read`.
* `dst-path` is the destination path, like `file/path/name` when `read` or `gcs://your-bucket-name/your-file-path` when `write`.
* `account` is a bucket access account.
* `secret` is a bucket access secret.
* `type` is the bucket access credential type, default is `json`.
* `expiration` is the expiration time for signed URLs for the storage API in minutes, default is 20min. 
 
